---
title: git的.gitignore文件的规则
categories: WEB前端
copyright: true
date: 2020-10-23 16:31:10
tags:
  - git
---

## 前言

对于经常使用 Git 的朋友来说，.gitignore 配置一定不会陌生。废话不说多了，接下来就来说说这个.gitignore 的使用。首先要强调一点，这个文件的完整文件名就是".gitignore"，注意最前面有个“.”。一般来说每个 Git 项目中都需要一个“.gitignore”文件，这个文件的作用就是告诉 Git 哪些文件不需要添加到版本管理中。实际项目中，很多文件都是不需要版本管理的，比如 Python 的.pyc 文件和一些包含密码的配置文件等等。这个文件的内容是一些规则，Git 会根据这些规则来判断是否将文件添加到版本控制中。<!--more-->
## 简介
#### 下面我们看看常用的规则：

1. /mtk/ 过滤整个文件夹
2. \*.zip 过滤所有.zip 文件
3. /mtk/do.c 过滤某个具体文件

很简单吧，被过滤掉的文件就不会出现在 git 仓库中（gitlab 或 github）了，当然本地库中还有，只是 push 的时候不会上传。

需要注意的是，gitignore 还可以指定要将哪些文件添加到版本管理中：
1. !\*.zip
1. !/mtk/one.txt

唯一的区别就是规则开头多了一个感叹号，Git 会将满足这类规则的文件添加到版本管理中。

#### 为什么要有两种规则呢？

想象一个场景：假如我们只需要管理/mtk/目录中的 one.txt 文件，这个目录中的其他文件都不需要管理，那么我们就需要使用：
1. /mtk/

2. !/mtk/one.txt

假设我们只有过滤规则，而没有添加规则，那么我们就需要把/mtk/目录下除了 one.txt 以外的所有文件都写出来！

最后需要强调的一点是，如果你不慎在创建.gitignore 文件之前就 push 了项目，那么即使你在.gitignore 文件中写入新的过滤规则，这些规则也不会起作用，Git 仍然会对所有文件进行版本管理。

简单来说，出现这种问题的原因就是 Git 已经开始管理这些文件了，所以你无法再通过过滤规则过滤它们。因此一定要养成在项目开始就创建.gitignore 文件的习惯，否则一旦 push，处理起来会非常麻烦。

## 规则
.gitignore 配置文件用于配置不需要加入版本管理的文件，配置好该文件可以为版本管理带来很大的便利，以下是对于配置.gitignore 的一些心得记录：

1. **配置语法：**
以斜杠“/”开头表示目录；
以星号“\*”通配多个字符；
以问号“?”通配单个字符
以方括号“[]”包含单个字符的匹配列表；
以叹号“!”表示不忽略(跟踪)匹配到的文件或目录；

此外，git 对于 .ignore 配置文件是按行从上到下进行规则匹配的，意味着如果前面的规则匹配的范围更大，则后面的规则将不会生效；

2. **示例说明**
- 规则：fd1/_
说明：忽略目录 fd1 下的全部内容；注意，不管是根目录下的 /fd1/ 目录，还是某个子目录 /child/fd1/ 目录，都会被忽略；
- 规则：/fd1/_
说明：忽略根目录下的 /fd1/ 目录的全部内容；
- 规则：
/\*
!.gitignore
!/fw/bin/
!/fw/sf/
说明：忽略全部内容，但是不忽略 .gitignore 文件、根目录下的 /fw/bin/ 和 /fw/sf/ 目录；

下面是线上使用过的一个 gerrit 里项目代码的.gitignore 的配置（在项目中添加.gitignore 过滤文件，在 git push 到 gerrit 里即可）

```
$ cat .gitignore
#Built application files
*.apk
*.ap_
 
# Files for the Dalvik VM
*.dex
 
# Java class files
*.class
 
# Generated files
*/bin/
*/gen/
*/out/
 
# Gradle files
.gradle/
build/
*/build/
gradlew
gradlew.bat
 
# Local configuration file (sdk path, etc)
local.properties
 
# Proguard folder generated by Eclipse
proguard/
 
# Log Files
*.log
 
# Android Studio Navigation editor temp files
.navigation/
 
# Android Studio captures folder
captures/
 
# Intellij
*.iml
*/*.iml
 
# Keystore files
#*.jks
#gradle wrapper
gradle/
 
#some local files
*/.settings/
*/.DS_Store
.DS_Store
*/.idea/
.idea/
gradlew
gradlew.bat
unused.txt
```
在看一个例子
```
$ cat .gitignore
# Lines that start with '#' are comments.
# IntelliJ IDEA Project files
.idea
*.iml
*.ipr
*.iws
out
 
# Eclipse Project files
.classpath
.project
.settings/
 
bin/
gen/
local.properties
 
.DS_Store
Thumbs.db
 
*.bak
*.tem
*.temp
#.swp
*.*~
~*.*
```

其实，需要清除的一点是：
有三种方法可以实现过滤掉 Git 里不想上传的文件，这三种方法都能达到目的，只不过适用情景不一样。

### 1. 第一种方法
针对单一工程排除文件，这种方式会让这个工程的所有修改者在克隆代码的同时，也能克隆到过滤规则，而不用自己再写一份，这就能保证所有修改者应用的都是同一份规则，而不是张三自己有一套过滤规则，李四又使用另一套过滤规则，个人比较喜欢这个。配置步骤如下：

在工程根目录下建立.gitignore 文件，将要排除的文件或目录 写到.gitignore 这个文件中，其中有两种写入方法。
a)使用命令行增加排除文件
排除以.class 结尾的文件 echo “\*.class” >.gitignore (>> 是在文件尾增加,> 是删除已经存在的内容再增加)，之后会在当前目录下生成一个.gitignore 的文件。
排除 bin 目录下的文件 echo “bin/” >.gitignore
b)最方便的办法是，用记事本打开，增加需要排除的文件或目录，一行增加一个，例如：
```
_.class
_.apk
bin/
gen/
.settings/
proguard/
```
### 2. 第二种方法
全局设置排除文件，这会在全局起作用，只要是 Git 管理的工程，在提交时都会自动排除不在控制范围内的文件或目录。这种方法对开发者来说，比较省事，只要一次全局配置，不用每次建立工程都要配置一遍过滤规则。但是这不保证其他的开发者在克隆你的代码后，他们那边的规则跟你的是一样的，这就带来了代码提交过程中的各种冲突问题。
配置步骤如下：
a）像方法（1）一样，也需要建立一个.gitignore 文件，把要排除的文件写进去。
b）但在这里，我们不规定一定要把.gitnore 文件放到某个工程下面，而是任何地方，比如我们这里放到了 Git 默认的 Home 路径下，比如：/home/wangshibo/hqsb_ios
c）使用命令方式可以配置全局排除文件 git config --global core.excludesfile ~/.gitignore，你会发现在~/.gitconfig 文件中会出现 excludesfile = /home/wangshibo/hqsb_ios/.gitignore。
说明 Git 把文件过滤规则应用到了 Global 的规则中。

### 3. 第三种方法
单个工程设置排除文件，在工程目录下找到.git/info/exclude，把要排除的文件写进去：
```
_.class
_.apk
bin/
gen/
.settings/
proguard/
```
这种方法就不提倡了，只能针对单一工程配置，而且还不能将过滤规则同步到其他开发者，跟方法（1）（2）比较起来没有一点优势。

## Git 忽略规则及.gitignore 规则不生效的解决办法
在 git 中如果想忽略掉某个文件，不让这个文件提交到版本库中，可以使用修改根目录中 .gitignore 文件的方法（如无，则需自己手工建立此文件）。这个文件每一行保存了一个匹配的规则例如：
```
# 此为注释 – 将被 Git 忽略

_.a # 忽略所有 .a 结尾的文件
!lib.a # 但 lib.a 除外
/TODO # 仅仅忽略项目根目录下的 TODO 文件，不包括 subdir/TODO
build/ # 忽略 build/ 目录下的所有文件
doc/_.txt # 会忽略 doc/notes.txt 但不包括 doc/server/arch.txt
规则很简单，不做过多解释，但是有时候在项目开发过程中，突然心血来潮想把某些目录或文件加入忽略规则，按照上述方法定义后发现并未生效，原因是.gitignore 只能忽略那些原来没有被 track 的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore 是无效的。那么解决方法就是先把本地缓存删除（改变成未 track 状态），然后再提交：

git rm -r --cached .
git add .
git commit -m 'update .gitignore'
```
注意：
不要误解了 .gitignore 文件的用途，该文件只能作用于 Untracked Files，也就是那些从来没有被 Git 记录过的文件（自添加以后，从未 add 及 commit 过的文件）。
如果文件曾经被 Git 记录过，那么.gitignore 就对它们完全无效。
